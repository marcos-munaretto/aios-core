# 1MCP Configuration Template for AIOS
# Purpose: Define MCP servers and presets for AIOS agents
# Location: ~/.1mcp/config.json (generated from this template)

# ==============================================================================
# MCP SERVERS
# ==============================================================================
mcps:
  # Documentation & Research MCP
  context7:
    command: "npx"
    args: ["-y", "@upstash/context7-mcp"]
    enabled: true
    description: "Library/framework documentation lookup"
    use_cases:
      - "Architecture research"
      - "API reference lookup"
      - "Learning new frameworks"
    agents: ["architect", "analyst", "dev"]

  # GitHub Operations MCP
  github:
    command: "npx"
    args: ["-y", "@modelcontextprotocol/server-github"]
    enabled: true
    environment:
      GITHUB_TOKEN: "${GITHUB_TOKEN}"  # Set in environment
    description: "GitHub API operations (repos, issues, PRs)"
    use_cases:
      - "Story implementation"
      - "Pull request creation"
      - "Issue tracking"
      - "Code review"
    agents: ["dev", "qa", "sm", "po"]

  # Browser Automation MCP
  browser:
    command: "npx"
    args: ["-y", "@modelcontextprotocol/server-puppeteer"]
    enabled: true
    description: "Browser automation and web scraping"
    use_cases:
      - "UI testing"
      - "Web scraping"
      - "Screenshot generation"
      - "Integration testing"
    agents: ["qa", "dev", "analyst"]

  # Docker & Containers MCP (disabled by default)
  docker:
    command: "npx"
    args: ["-y", "@docker/mcp-server-docker-desktop"]
    enabled: false  # Enable only when needed
    description: "Docker container management"
    use_cases:
      - "Container operations"
      - "Docker Compose management"
      - "Image building"
      - "Deployment automation"
    agents: ["devops", "sm"]

# ==============================================================================
# PRESETS (Agent-Specific Configurations)
# ==============================================================================
presets:
  # Development Preset (Default)
  aios-dev:
    filter: ["github", "browser"]
    description: "Story implementation, PRs, development tasks"
    token_budget: "25-40K"
    agents: ["dev", "qa", "sm"]
    use_cases:
      - "Story implementation (docs/stories/*.md)"
      - "Pull request creation"
      - "Code review and validation"
      - "Issue tracking and management"
      - "Sprint planning"
    recommended: true

  # Research Preset
  aios-research:
    filter: ["context7", "browser"]
    description: "Documentation-heavy research and learning"
    token_budget: "40-60K"
    agents: ["architect", "analyst"]
    use_cases:
      - "Architecture design and research"
      - "Framework evaluation"
      - "API reference lookup"
      - "Best practices research"
      - "Documentation writing"
    recommended: false

  # Docker Preset (On-Demand)
  aios-docker:
    filter: ["docker", "browser"]
    description: "Container management and deployment"
    token_budget: "15-20K"
    agents: ["devops"]
    use_cases:
      - "Docker container operations"
      - "Deployment automation"
      - "Integration testing with containers"
      - "Service orchestration"
    recommended: false
    enable_only_when_needed: true

  # Full Preset (Rare Use)
  aios-full:
    filter: ["context7", "github", "browser"]
    description: "Complex multi-domain tasks requiring all tools"
    token_budget: "60-80K"
    agents: ["all"]
    use_cases:
      - "Complex exploratory work"
      - "Emergency debugging (need all tools)"
      - "Multi-domain integration tasks"
    recommended: false
    warning: "Use sparingly - higher token cost"

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
server:
  port: 3050
  host: "127.0.0.1"  # Localhost only (security)
  timeout: 30000     # 30 seconds
  max_retries: 3

# ==============================================================================
# MONITORING & LOGGING
# ==============================================================================
monitoring:
  enabled: true
  metrics:
    track_token_usage: true
    track_preset_usage: true
    track_mcp_errors: true
  logging:
    level: "info"  # "debug" | "info" | "warn" | "error"
    file: "~/.1mcp/logs/server.log"

# ==============================================================================
# AIOS INTEGRATION
# ==============================================================================
aios_integration:
  # Automatic preset selection based on agent
  auto_preset_selection:
    enabled: true
    mappings:
      dev: "aios-dev"
      qa: "aios-dev"
      sm: "aios-dev"
      po: "aios-dev"
      architect: "aios-research"
      analyst: "aios-research"
      devops: "aios-docker"

  # Token budget alerts
  token_budget_alerts:
    enabled: true
    warn_threshold: 50000   # Warn if > 50K tokens
    error_threshold: 80000  # Error if > 80K tokens

  # Automatic fallback
  fallback:
    enabled: true
    if_preset_fails: "aios-dev"  # Fallback to dev preset
    if_server_down: "direct_mcp"  # Fallback to direct MCPs

# ==============================================================================
# USAGE EXAMPLES
# ==============================================================================
examples:
  # Example 1: Story Implementation (@dev agent)
  story_implementation:
    agent: "dev"
    preset: "aios-dev"
    mcps_used: ["github", "browser"]
    token_budget: "~35K"
    workflow:
      - "Read story file (filesystem)"
      - "Search related code (github.search_code)"
      - "Implement changes (filesystem.write)"
      - "Create PR (github.create_pr)"
      - "Update story progress (filesystem.write)"

  # Example 2: Architecture Research (@architect agent)
  architecture_research:
    agent: "architect"
    preset: "aios-research"
    mcps_used: ["context7", "browser"]
    token_budget: "~50K"
    workflow:
      - "Look up framework docs (context7)"
      - "Browse examples (browser.navigate)"
      - "Research best practices (context7 + browser)"
      - "Document findings (filesystem.write)"

  # Example 3: Docker Deployment (@devops)
  docker_deployment:
    agent: "devops"
    preset: "aios-docker"
    mcps_used: ["docker", "browser"]
    token_budget: "~18K"
    workflow:
      - "Build Docker image (docker.build)"
      - "Run container (docker.run)"
      - "Test deployment (browser.navigate)"
      - "Verify health (browser.screenshot)"

# ==============================================================================
# NOTES
# ==============================================================================
notes:
  token_reduction: "85% (280K → 40K with aios-dev)"
  production_ready: true
  validated_by: "AIOS Roundtable 2025-01-14"
  experts:
    - "Pedro Valério (Systems Architecture)"
    - "Mitchell Hashimoto (Infrastructure)"
    - "Andrej Karpathy (AI Systems)"
    - "Guillermo Rauch (Developer Experience)"
  decision: "Use 1MCP (Phase 1), defer TOON to Phase 2 pending benchmark"
  documentation: "docs/guides/1mcp-implementation.md"
