# Workflow Patterns Definition
# Defines common AIOS workflow sequences for context detection
#
# Version: 1.0
# Created: 2025-01-15
# Story: 6.1.2.5 - Contextual Agent Load System
#
# Format:
# - workflow_name: Unique identifier
# - description: Human-readable workflow description
# - agent_sequence: Expected sequence of agents used
# - key_commands: Commands that signal this workflow
# - trigger_threshold: Minimum matching commands to detect pattern (default: 2)

workflows:
  # Story Development Workflow (Most Common)
  story_development:
    description: "Complete story lifecycle from validation to deployment"
    agent_sequence:
      - po         # Story validation
      - dev        # Implementation
      - qa         # Quality assurance
      - devops     # Deployment
    key_commands:
      - validate-story-draft
      - validate-next-story
      - develop
      - develop-yolo
      - develop-interactive
      - develop-preflight
      - review-qa
      - apply-qa-fixes
      - pre-push-quality-gate
      - github-pr-automation
    trigger_threshold: 2
    typical_duration: "1-5 days"
    success_indicators:
      - "Story status: Ready for Review"
      - "All tests passing"
      - "PR created and merged"
    # Workflow transitions (Story 6.1.2.5 - Workflow Navigation)
    transitions:
      validated:
        trigger: "validate-story-draft completed successfully"
        greeting_message: "Story validated! Ready to implement."
        next_steps:
          - command: develop-yolo
            args_template: "${story_path}"
            description: "Autonomous YOLO mode (no interruptions)"
          - command: develop-interactive
            args_template: "${story_path}"
            description: "Interactive mode with checkpoints (default)"
          - command: develop-preflight
            args_template: "${story_path}"
            description: "Plan everything upfront, then execute"
      in_development:
        trigger: "develop completed successfully"
        greeting_message: "Development complete! Ready for QA review."
        next_steps:
          - command: review-qa
            args_template: "${story_path}"
            description: "Run QA review and tests"
          - command: run-tests
            args_template: ""
            description: "Execute test suite manually"
      qa_reviewed:
        trigger: "review-qa completed successfully"
        greeting_message: "QA review complete!"
        next_steps:
          - command: apply-qa-fixes
            args_template: ""
            description: "Apply QA feedback and fixes"
          - command: pre-push-quality-gate
            args_template: ""
            description: "Run final quality checks before push"

  # Epic Creation Workflow
  epic_creation:
    description: "Create and organize epics with initial stories"
    agent_sequence:
      - po         # Epic planning
      - sm         # Story creation
      - architect  # Technical review
    key_commands:
      - create-epic
      - brownfield-create-epic
      - create-story
      - brownfield-create-story
      - create-next-story
      - validate-story-draft
      - analyze-impact
    trigger_threshold: 2
    typical_duration: "0.5-2 days"
    success_indicators:
      - "Epic documented"
      - "Initial stories created"
      - "Stories validated"

  # Backlog Management Workflow
  backlog_management:
    description: "Review, prioritize, and schedule backlog items"
    agent_sequence:
      - qa         # Backlog review
      - po         # Prioritization
      - pm         # Scheduling
    key_commands:
      - backlog-add
      - backlog-update
      - backlog-review
      - backlog-debt
      - backlog-summary
      - backlog-prioritize
      - backlog-schedule
    trigger_threshold: 2
    typical_duration: "0.5-1 day"
    success_indicators:
      - "Backlog items prioritized"
      - "Sprint planned"

  # Architecture Review Workflow
  architecture_review:
    description: "Design review and documentation of architectural decisions"
    agent_sequence:
      - architect  # Design and review
      - qa         # Review validation
      - dev        # Implementation planning
    key_commands:
      - analyze-impact
      - analyze-framework
      - create-doc
      - shard-doc
      - review-proposal
      - review-story
      - architect-analyze-impact
    trigger_threshold: 2
    typical_duration: "1-3 days"
    success_indicators:
      - "Architecture documented"
      - "Decision reviewed"
      - "Implementation plan approved"

  # Git Workflow (DevOps)
  git_workflow:
    description: "Version control and deployment workflow"
    agent_sequence:
      - dev        # Code changes
      - devops     # Git operations
    key_commands:
      - pre-push-quality-gate
      - github-pr-automation
      - repository-cleanup
      - version-management
    trigger_threshold: 2
    typical_duration: "0.5-1 day"
    success_indicators:
      - "Changes committed"
      - "PR created"
      - "Code merged"

  # Database Development Workflow
  database_workflow:
    description: "Database schema design and migration workflow"
    agent_sequence:
      - data-engineer  # Schema design
      - dev            # Migration implementation
      - qa             # Testing
    key_commands:
      - db-domain-modeling
      - db-schema-audit
      - db-dry-run
      - db-apply-migration
      - db-rollback
      - db-smoke-test
      - db-rls-audit
      - db-verify-order
    trigger_threshold: 2
    typical_duration: "1-3 days"
    success_indicators:
      - "Schema designed"
      - "Migrations tested"
      - "RLS policies validated"

  # Code Quality Improvement Workflow
  code_quality_workflow:
    description: "Refactoring and code quality improvements"
    agent_sequence:
      - qa         # Quality assessment
      - dev        # Refactoring
    key_commands:
      - improve-code-quality
      - suggest-refactoring
      - optimize-performance
      - security-scan
      - generate-tests
      - nfr-assess
    trigger_threshold: 2
    typical_duration: "0.5-2 days"
    success_indicators:
      - "Code refactored"
      - "Tests added"
      - "Quality metrics improved"

  # Documentation Workflow
  documentation_workflow:
    description: "Create and synchronize project documentation"
    agent_sequence:
      - analyst    # Research and analysis
      - architect  # Documentation creation
      - po         # Review
    key_commands:
      - document-project
      - sync-documentation
      - create-doc
      - shard-doc
      - index-docs
      - generate-documentation
    trigger_threshold: 2
    typical_duration: "0.5-2 days"
    success_indicators:
      - "Documentation created"
      - "Documentation synchronized"
      - "Documentation indexed"

  # UX Design Workflow
  ux_workflow:
    description: "User experience design and validation"
    agent_sequence:
      - ux-design-expert  # Design
      - dev               # Implementation
      - qa                # Validation
    key_commands:
      - ux-create-wireframe
      - ux-user-research
      - ux-ds-scan-artifact
      - build-component
      - audit-codebase
    trigger_threshold: 2
    typical_duration: "1-3 days"
    success_indicators:
      - "Wireframes created"
      - "Components implemented"
      - "UX validated"

  # Brainstorming and Research Workflow
  research_workflow:
    description: "Facilitated brainstorming and research sessions"
    agent_sequence:
      - analyst    # Research
      - architect  # Analysis
      - po         # Documentation
    key_commands:
      - analyst-facilitate-brainstorming
      - advanced-elicitation
      - create-deep-research-prompt
      - kb-mode-interaction
    trigger_threshold: 2
    typical_duration: "0.5-1 day"
    success_indicators:
      - "Research completed"
      - "Ideas documented"
      - "Action items created"

# Validation Notes:
# - Patterns cross-referenced with Epic 6.1 workflow analysis
# - Commands verified against actual project usage in .aios-core/agents/*.md
# - Agent sequences match actual workflow patterns from recent stories
# - Threshold of 2 ensures workflow detection is accurate but not overly sensitive
