# Story 2.2: Git Workflow Implementation - Fix Checklist

**Date**: 2025-01-23
**Validator**: Sarah (Product Owner)
**Status**: CONDITIONAL NO-GO - Fixes Required
**Estimated Fix Time**: 3 hours

---

## ðŸ”´ PRIORITY 1: CRITICAL BLOCKERS (2 hours)

### âœ… Task 1.1: Add User Story Statement (30 min)

**Location**: Add new `story:` section after `status:` field

**Action Required**:
```yaml
story:
  as_a: "AIOS-FULLSTACK developer"
  i_want: "automated Git workflow with multi-layer validation"
  so_that: "code quality is enforced at commit, push, and merge stages, preventing broken code from entering the main branch"
```

**Verification**:
- [ ] Story statement follows "As a... I want... so that..." format
- [ ] Clearly identifies user role (developer)
- [ ] Describes concrete action (automated validation)
- [ ] Explains user benefit (quality enforcement)

---

### âœ… Task 1.2: Fix Validator Location Conflict (15 min)

**Issue**: Story uses `validators/` directory, Architect validated `.aios-core/utils/`

**Files to Update**:

1. **Phase 1 - Deliverables** (line ~99):
   ```yaml
   # BEFORE
   deliverables:
     - ".husky/pre-commit (atualizado)"
     - "validators/pre-commit-validator.js"

   # AFTER
   deliverables:
     - ".husky/pre-commit (atualizado)"
     - ".aios-core/utils/aios-validator.js"
   ```

2. **Phase 2 - Deliverables** (line ~111):
   ```yaml
   # BEFORE
   deliverables:
     - ".husky/pre-push"
     - "validators/story-validator.js"

   # AFTER
   deliverables:
     - ".husky/pre-push"
     - ".aios-core/utils/aios-validator.js (story validation functions)"
   ```

3. **Testing Strategy - Unit Tests** (line ~175):
   ```yaml
   # BEFORE
   unit_tests:
     - "validators/pre-commit-validator.test.js"
     - "validators/story-validator.test.js"

   # AFTER
   unit_tests:
     - ".aios-core/utils/aios-validator.test.js"
     - "tests/unit/pre-commit-validation.test.js"
     - "tests/unit/story-validation.test.js"
   ```

**Verification**:
- [ ] All references to `validators/` directory removed
- [ ] All references updated to `.aios-core/utils/`
- [ ] Matches Architect validation (PRD lines 1143-1168)

---

### âœ… Task 1.3: Document Configuration Creation Requirements (30 min)

**Issue**: Story claims ESLint/TypeScript "jÃ¡ configurados" but they don't exist

**Location**: Add new subsection to `technical_notes:` section

**Action Required**:
```yaml
technical_notes:
  # ... existing architecture, tools, risks, constraints ...

  configuration_requirements:
    eslint:
      status: "TO BE CREATED in Phase 1"
      file: ".eslintrc.json"
      config:
        extends:
          - "eslint:recommended"
          - "plugin:@typescript-eslint/recommended"
        cache: true
        cacheLocation: ".eslintcache"
        env:
          node: true
          es2022: true
        rules:
          no-console: "warn"
          no-unused-vars: "error"

    typescript:
      status: "TO BE CREATED in Phase 1"
      file: "tsconfig.json"
      config:
        compilerOptions:
          target: "ES2022"
          module: "commonjs"
          lib: ["ES2022"]
          strict: true
          esModuleInterop: true
          skipLibCheck: true
          forceConsistentCasingInFileNames: true
          incremental: true
          tsBuildInfoFile: ".tsbuildinfo"
        include:
          - ".aios-core/**/*"
          - "tools/**/*"
          - "scripts/**/*"
        exclude:
          - "node_modules"
          - "dist"

    jest:
      status: "TO BE CREATED in Phase 1"
      file: "jest.config.js"
      framework: "Jest 29.x"
      config:
        testEnvironment: "node"
        testMatch:
          - "**/*.test.js"
          - "**/tests/**/*.js"
        collectCoverageFrom:
          - ".aios-core/utils/**/*.js"
          - "scripts/**/*.js"
        coverageThreshold:
          global:
            branches: 80
            functions: 80
            lines: 80
            statements: 80

    gitignore_additions:
      - "# Validation cache files"
      - ".eslintcache"
      - ".tsbuildinfo"
      - "coverage/"
```

**Update Phase 1 Tasks** (line ~93):
```yaml
phase: 1
name: "Local Validation (Pre-commit)"
duration: "2.5h"  # Increased from 2h
tasks:
  - "Criar .eslintrc.json na raiz do projeto"
  - "Criar tsconfig.json na raiz do projeto"
  - "Adicionar .eslintcache e .tsbuildinfo ao .gitignore"
  - "Implementar pre-commit hook com ESLint + TypeScript"
  - "Adicionar mensagens de erro amigÃ¡veis (chalk colors)"
  - "Configurar cache para performance"
  - "Testar com casos de sucesso e falha"
```

**Verification**:
- [ ] All three config files documented (ESLint, TypeScript, Jest)
- [ ] Config content specified (not just filenames)
- [ ] Phase 1 tasks updated to include config creation
- [ ] .gitignore additions documented

---

### âœ… Task 1.4: Add Source Tree Context (30 min)

**Location**: Add new subsection to `technical_notes:` section

**Action Required**:
```yaml
technical_notes:
  # ... existing sections ...

  current_source_tree:
    description: "Relevant existing structure for this story"
    structure: |
      aios-fullstack/
      â”œâ”€â”€ .husky/                          # Git hooks (Husky 9.1.7)
      â”‚   â”œâ”€â”€ _/                           # Husky internals
      â”‚   â””â”€â”€ pre-commit                   # EXISTS - will be updated
      â”œâ”€â”€ .github/
      â”‚   â””â”€â”€ workflows/                   # TO BE CREATED
      â”‚       â””â”€â”€ ci.yml                   # New CI/CD workflow
      â”œâ”€â”€ .aios-core/
      â”‚   â”œâ”€â”€ agents/
      â”‚   â”‚   â””â”€â”€ dev.md                   # Will reference new tasks
      â”‚   â”œâ”€â”€ tasks/
      â”‚   â”œâ”€â”€ templates/
      â”‚   â”œâ”€â”€ tools/
      â”‚   â””â”€â”€ utils/                       # TO BE CREATED
      â”‚       â”œâ”€â”€ aios-validator.js        # New validator
      â”‚       â””â”€â”€ aios-validator.test.js   # New tests
      â”œâ”€â”€ scripts/                         # TO BE CREATED (if not exists)
      â”‚   â””â”€â”€ setup-branch-protection.js   # New script
      â”œâ”€â”€ tests/                           # TO BE CREATED (if not exists)
      â”‚   â””â”€â”€ unit/
      â”‚       â”œâ”€â”€ pre-commit-validation.test.js
      â”‚       â””â”€â”€ story-validation.test.js
      â”œâ”€â”€ docs/
      â”‚   â”œâ”€â”€ stories/
      â”‚   â”‚   â””â”€â”€ 2.2-git-workflow-implementation.yaml  # This story
      â”‚   â””â”€â”€ git-workflow-guide.md        # TO BE CREATED
      â”œâ”€â”€ package.json                     # UPDATE scripts section
      â”œâ”€â”€ .eslintrc.json                   # TO BE CREATED
      â”œâ”€â”€ tsconfig.json                    # TO BE CREATED
      â”œâ”€â”€ jest.config.js                   # TO BE CREATED
      â”œâ”€â”€ README.md                        # UPDATE with Git Workflow section
      â””â”€â”€ CONTRIBUTING.md                  # TO BE CREATED

    existing_package_json_scripts:
      - "prepare: husky"                   # Already configured
      - "lint-staged: configured"          # Lines 114-118 in package.json
      - "TO ADD: lint"
      - "TO ADD: typecheck"
      - "TO ADD: test"

    existing_dependencies:
      husky: "9.1.7"                       # Already installed
      chalk: "4.1.2"                       # Already installed
      lint-staged: "configured"            # Already installed

    new_dependencies_needed:
      - "@typescript-eslint/parser"
      - "@typescript-eslint/eslint-plugin"
      - "eslint"
      - "typescript"
      - "jest"
      - "@types/jest"
```

**Verification**:
- [ ] Shows current structure clearly
- [ ] Distinguishes EXISTS vs TO BE CREATED
- [ ] Shows where new files go
- [ ] Documents existing dependencies
- [ ] Lists new dependencies needed

---

### âœ… Task 1.5: Add Missing Template Sections (30 min)

**Location**: Add three new sections at end of file (before `metadata:`)

**Action Required**:

```yaml
# ... existing sections ...

change_log:
  - date: "2025-01-23"
    version: "1.0"
    description: "Initial story creation from PRD analysis"
    author: "Sarah (Product Owner)"

  - date: "2025-01-23"
    version: "1.1"
    description: "Added missing template sections after PO validation"
    author: "Sarah (Product Owner)"

dev_agent_record:
  agent_model: null
  agent_version: null
  implementation_date: null

  debug_log_references: []

  completion_notes: []

  file_list: []

  implementation_summary: null

qa_results:
  qa_agent: "Quinn (Test Architect)"
  review_date: null

  test_execution_results: null

  acceptance_criteria_validation: []

  quality_gates_status: null

  issues_found: []

  sign_off: null

metadata:
  created_at: "2025-01-23T00:00:00Z"
  updated_at: "2025-01-23T00:00:00Z"
  version: "1.1"  # Increment from 1.0
  tags: ["infrastructure", "git", "validation", "ci-cd", "quality"]
```

**Verification**:
- [ ] `change_log` section added with initial entries
- [ ] `dev_agent_record` section added with null placeholders
- [ ] `qa_results` section added with null placeholders
- [ ] `metadata.version` incremented to 1.1
- [ ] `metadata.updated_at` set to current timestamp

---

## ðŸŸ¡ PRIORITY 2: QUALITY IMPROVEMENTS (1 hour)

### âœ… Task 2.1: Specify Test Framework Details (15 min)

**Location**: Update `testing_strategy:` section

**Action Required**:
```yaml
testing_strategy:
  test_framework:
    name: "Jest"
    version: "29.x"
    runner: "jest"
    config_file: "jest.config.js"

  test_patterns:
    unit_tests: "**/*.test.js"
    integration_tests: "**/tests/integration/**/*.js"

  coverage_reporting:
    tool: "jest --coverage"
    format: ["text", "lcov", "html"]
    output: "coverage/"
    thresholds:
      branches: 80
      functions: 80
      lines: 80
      statements: 80

  unit_tests:
    - ".aios-core/utils/aios-validator.test.js"
    - "tests/unit/pre-commit-validation.test.js"
    - "tests/unit/story-validation.test.js"

  # ... rest of testing_strategy ...
```

**Verification**:
- [ ] Jest specified as test framework
- [ ] Test patterns documented
- [ ] Coverage thresholds match Definition of Done (80%)
- [ ] Coverage reporting configured

---

### âœ… Task 2.2: Update Phase 0 Commit Reference (5 min)

**Location**: `notes:` section (line ~212)

**Action Required**:
```yaml
notes:
  - "Phase 0 (Cleanup) jÃ¡ completa - commit 5878e89"  # Updated from 4f9bd16
  - "Este Story implementa 8 mandatory adjustments do PO"
  - "Architect validou timeline: 10h realista (era 9.5h, +0.5h caching)"
  - "Segue polÃ­tica: GitHub CLI always, never REST APIs"
  - "Story 2.3 (NPX Fix) depende deste estar completo"
```

**Verification**:
- [ ] Commit hash corrected to 5878e89
- [ ] Timeline note updated with Architect adjustment
- [ ] All other notes preserved

---

### âœ… Task 2.3: Document Lint-Staged Integration (20 min)

**Location**: Add new subsection to `technical_notes:` section

**Action Required**:
```yaml
technical_notes:
  # ... existing sections ...

  lint_staged_integration:
    description: "Existing lint-staged config (package.json lines 114-118)"
    current_config:
      pattern: "*.{js,json,md}"
      commands:
        - "prettier --write"

    new_integration:
      description: "Pre-commit hook will use both lint-staged AND aios-validator"
      execution_order:
        1: "lint-staged (prettier formatting)"
        2: "aios-validator --fast (AIOS structure, ESLint, TypeScript)"

      husky_pre_commit_script: |
        #!/usr/bin/env sh
        . "$(dirname -- "$0")/_/husky.sh"

        # Run lint-staged first (formatting)
        npx lint-staged

        # Then run AIOS validation
        node .aios-core/utils/aios-validator.js --fast

      performance_target: "<5s total (lint-staged ~2s, validator ~3s)"
```

**Verification**:
- [ ] Current lint-staged config documented
- [ ] Integration approach specified
- [ ] Execution order clarified
- [ ] Performance target maintained

---

### âœ… Task 2.4: Add PO Mandatory Adjustments Checklist (20 min)

**Location**: Add new subsection to `implementation_plan:` section

**Action Required**:
```yaml
implementation_plan:
  # ... existing phases ...

  po_mandatory_adjustments:
    description: "8 mandatory adjustments from PO validation (PRD lines 943-988)"
    status: "To be implemented across all phases"

    checklist:
      - id: "PO-1"
        adjustment: "Branch Protection via GitHub settings (not just validation)"
        phase: "Phase 4"
        status: "Planned"
        implementation: "Configure protection rules in GitHub UI with required approvals"

      - id: "PO-2"
        adjustment: "Validator location in .aios-core/utils/ (not tools/local/)"
        phase: "Phase 1"
        status: "Planned"
        implementation: "Create .aios-core/utils/aios-validator.js"

      - id: "PO-3"
        adjustment: "Use Husky for git hooks (not pre-commit framework)"
        phase: "Phase 1-2"
        status: "Planned"
        implementation: "Configure .husky/pre-commit and .husky/pre-push"

      - id: "PO-4"
        adjustment: "Implement caching strategy (GitHub Actions + local)"
        phase: "Phase 3"
        status: "Planned"
        implementation: "actions/cache@v3 + ESLint cache + TypeScript incremental"

      - id: "PO-5"
        adjustment: "Troubleshooting section in guide (Common Issues)"
        phase: "Phase 5"
        status: "Planned"
        implementation: "Add troubleshooting to docs/git-workflow-guide.md"

      - id: "PO-6"
        adjustment: "Practical examples with visual flow (screenshots/diagrams)"
        phase: "Phase 5"
        status: "Planned"
        implementation: "Add flow diagram: feature â†’ commit â†’ PR â†’ merge"

      - id: "PO-7"
        adjustment: "Story validation (checkbox completion checking)"
        phase: "Phase 2"
        status: "Planned"
        implementation: "Validator checks docs/stories/*.md for incomplete [ ] items"

      - id: "PO-8"
        adjustment: "Cross-platform testing (Windows, macOS, Linux)"
        phase: "Phase 5"
        status: "Planned"
        implementation: "Test hooks in all 3 OS environments"
```

**Verification**:
- [ ] All 8 PO adjustments listed
- [ ] Each adjustment mapped to implementation phase
- [ ] Implementation approach described for each
- [ ] Matches PRD documentation (lines 943-988)

---

## ðŸ“‹ VERIFICATION CHECKLIST

### Before Marking Story as READY:

**Template Compliance**:
- [ ] User story statement added (As a... I want... so that...)
- [ ] Change log section added with initial entries
- [ ] Dev Agent Record section added with null placeholders
- [ ] QA Results section added with null placeholders

**Critical Technical Fixes**:
- [ ] Validator location updated to `.aios-core/utils/` in all references
- [ ] Configuration requirements documented (ESLint, TypeScript, Jest)
- [ ] Source tree context added showing current structure
- [ ] Phase 1 tasks updated to include config creation

**Quality Improvements**:
- [ ] Test framework specified (Jest 29.x)
- [ ] Phase 0 commit hash corrected (5878e89)
- [ ] Lint-staged integration documented
- [ ] PO mandatory adjustments checklist added

**Final Validation**:
- [ ] All YAML syntax valid (no parsing errors)
- [ ] All file paths consistent throughout document
- [ ] All version references accurate
- [ ] Document version incremented to 1.1
- [ ] Updated timestamp in metadata

---

## ðŸŽ¯ AFTER FIXES: RE-VALIDATION CRITERIA

**Story will be considered READY when**:

1. âœ… Implementation Readiness Score: â‰¥ 8.5/10 (currently 6.5/10)
2. âœ… All 4 critical template sections present
3. âœ… Validator location conflict resolved
4. âœ… Configuration creation requirements documented
5. âœ… Source tree context provided
6. âœ… Test framework specified
7. âœ… All cross-references accurate

**Expected Outcome**: **GO FOR IMPLEMENTATION**
- Dev Agent can implement without reading external docs
- All required context self-contained in story
- Clear success criteria and validation steps
- Proper tracking sections for all agents

---

## ðŸ“ NOTES FOR IMPLEMENTER

- Estimated fix time: **3 hours** (2h critical + 1h quality)
- All fixes can be done by PO (Sarah) - no Dev Agent needed
- After fixes applied, story can proceed directly to Dev Agent (James)
- No re-validation from Architect needed (technical approach already approved)

**Validation Report Reference**: `docs/stories/2.2-validation-report.md` (if needed)

---

**Checklist Status**: â³ IN PROGRESS
**Target Completion**: [Set deadline]
**Assigned To**: Sarah (Product Owner)
