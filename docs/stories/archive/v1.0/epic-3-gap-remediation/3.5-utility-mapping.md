# Story 3.5: Utility Integration Mapping - Part 2

**Created:** 2025-10-29  
**Authors:** Sarah (@po), Winston (@architect)  
**Purpose:** Define integration strategy for 22 utilities in Story 3.5  
**Pattern:** Follows Story 3.4 successful approach

---

## Utility Categorization

### Category 1: Migration Management (5 utilities)

| # | Utility | Target Agent | Integration Pattern | Priority |
|---|---------|--------------|---------------------|----------|
| 1 | **util-migration-generator** | agent-architect | Task Execution | HIGH |
| 2 | **util-migration-path-generator** | agent-architect | Agent Helper | HIGH |
| 3 | **util-migration-rollback** | agent-architect | Task Execution | MEDIUM |
| 4 | **util-migration-tester** | agent-qa | Agent Helper | MEDIUM |
| 5 | **util-git-wrapper** | agent-github-devops | Agent Helper | HIGH |

**Integration Approach:**
- Migration utilities support framework version migration workflows
- Primary user: agent-architect (migration planning and execution)
- git-wrapper supports github-devops for git operations
- Test migration reliability with migration-tester

**Notes:**
- migration-generator creates migration scripts
- migration-path-generator plans migration paths
- migration-rollback handles rollback scenarios
- migration-tester validates migrations before production
- git-wrapper abstracts git command execution

---

### Category 2: Modification Management (5 utilities)

| # | Utility | Target Agent | Integration Pattern | Priority |
|---|---------|--------------|---------------------|----------|
| 6 | **util-modification-history** | aios-developer | Agent Helper | HIGH |
| 7 | **util-modification-risk-assessment** | aios-developer | Agent Helper | HIGH |
| 8 | **util-modification-synchronizer** | aios-developer | Task Execution | MEDIUM |
| 9 | **util-modification-validator** | aios-developer | Agent Helper | HIGH |
| 10 | **util-rollback-handler** | aios-developer | Task Execution | HIGH |

**Integration Approach:**
- Support self-modification capabilities of aios-developer agent
- Enable safe framework modifications
- Track modification history for learning
- Validate modifications before application

**Notes:**
- modification-history tracks all framework modifications
- modification-risk-assessment evaluates change risk
- modification-synchronizer keeps modifications in sync
- modification-validator validates before applying
- rollback-handler handles rollback when needed

---

### Category 3: Self-Improvement (3 utilities)

| # | Utility | Target Agent | Integration Pattern | Priority |
|---|---------|--------------|---------------------|----------|
| 11 | **util-improvement-engine** | aios-developer | Framework | HIGH |
| 12 | **util-pattern-learner** | aios-developer | Framework | HIGH |
| 13 | **util-sandbox-tester** | aios-developer | Agent Helper | MEDIUM |

**Integration Approach:**
- Core self-improvement capabilities
- Framework-level utilities
- Used by aios-developer for autonomous improvement
- pattern-learner enables learning from successful modifications

**Notes:**
- improvement-engine generates improvement recommendations
- pattern-learner learns from successful patterns
- sandbox-tester tests modifications in isolated environment

---

### Category 4: Performance & Quality (4 utilities)

| # | Utility | Target Agent | Integration Pattern | Priority |
|---|---------|--------------|---------------------|----------|
| 14 | **util-performance-analyzer** | agent-dev | Agent Helper | MEDIUM |
| 15 | **util-performance-optimizer** | agent-dev | Task Execution | MEDIUM |
| 16 | **util-refactoring-suggester** | agent-dev | Agent Helper | MEDIUM |
| 17 | **util-redundancy-analyzer** | agent-architect | Agent Helper | LOW |

**Integration Approach:**
- Support code quality and performance optimization
- refactoring-suggester helps identify refactoring opportunities
- performance-analyzer identifies bottlenecks
- performance-optimizer applies optimizations
- redundancy-analyzer detects code duplication

**Notes:**
- performance-analyzer + performance-optimizer work together
- refactoring-suggester supports continuous improvement
- redundancy-analyzer helps maintain DRY principles

---

### Category 5: Framework Support (5 utilities)

| # | Utility | Target Agent | Integration Pattern | Priority |
|---|---------|--------------|---------------------|----------|
| 18 | **util-elicitation-session-manager** | (framework) | Framework | HIGH |
| 19 | **util-framework-analyzer** | agent-architect | Agent Helper | MEDIUM |
| 20 | **util-manifest-preview** | agent-dev | Agent Helper | LOW |
| 21 | **util-metrics-tracker** | (framework) | Framework | MEDIUM |
| 22 | **util-safe-removal-handler** | agent-architect | Task Execution | MEDIUM |

**Integration Approach:**
- Framework-level support utilities
- elicitation-session-manager supports agent/task creation workflows
- framework-analyzer enables architecture analysis
- metrics-tracker collects framework usage metrics
- safe-removal-handler enables safe component removal

**Notes:**
- elicitation-session-manager used by elicitation-engine
- framework-analyzer complements dependency-analyzer
- manifest-preview shows component previews
- metrics-tracker for framework telemetry
- safe-removal-handler prevents breaking changes

---

## Integration Priority Order

### Phase 1: HIGH Priority (11 utilities) - 3.5 hours

**Framework Self-Improvement:**
1. util-improvement-engine → aios-developer (Framework)
2. util-pattern-learner → aios-developer (Framework)
3. util-modification-history → aios-developer (Agent Helper)
4. util-modification-risk-assessment → aios-developer (Agent Helper)
5. util-modification-validator → aios-developer (Agent Helper)
6. util-rollback-handler → aios-developer (Task Execution)

**Migration Support:**
7. util-migration-generator → agent-architect (Task Execution)
8. util-migration-path-generator → agent-architect (Agent Helper)
9. util-git-wrapper → agent-github-devops (Agent Helper)

**Framework Analysis:**
10. util-elicitation-session-manager → framework (Framework)

### Phase 2: MEDIUM Priority (8 utilities) - 2.5 hours

**Modification & Migration:**
11. util-modification-synchronizer → aios-developer
12. util-migration-rollback → agent-architect
13. util-migration-tester → agent-qa

**Performance:**
14. util-performance-analyzer → agent-dev
15. util-performance-optimizer → agent-dev
16. util-refactoring-suggester → agent-dev

**Framework:**
17. util-framework-analyzer → agent-architect
18. util-metrics-tracker → framework
19. util-safe-removal-handler → agent-architect
20. util-sandbox-tester → aios-developer

### Phase 3: LOW Priority (2 utilities) - 30 min

21. util-redundancy-analyzer → agent-architect
22. util-manifest-preview → agent-dev

**Total Estimated Time:** 6.5 hours (corrected from 8h due to duplicate removal)

---

## Agent-to-Utility Mapping

### aios-developer Agent (10 utilities)
**Purpose:** Self-modification and improvement capabilities

- improvement-engine (Framework)
- pattern-learner (Framework)
- modification-history (Agent Helper)
- modification-risk-assessment (Agent Helper)
- modification-synchronizer (Task Execution)
- modification-validator (Agent Helper)
- rollback-handler (Task Execution)
- sandbox-tester (Agent Helper)

**New Tasks Needed:**
- task-propose-modification.md (update)
- task-improve-self.md (update)

---

### agent-architect (7 utilities)
**Purpose:** Migration planning and framework analysis

- migration-generator (Task Execution)
- migration-path-generator (Agent Helper)
- migration-rollback (Task Execution)
- framework-analyzer (Agent Helper)
- redundancy-analyzer (Agent Helper)
- safe-removal-handler (Task Execution)

**New Tasks Needed:**
- task-generate-migration.md (create)
- task-analyze-framework.md (update)

---

### agent-dev (4 utilities)
**Purpose:** Performance optimization and code quality

- performance-analyzer (Agent Helper)
- performance-optimizer (Task Execution)
- refactoring-suggester (Agent Helper)
- manifest-preview (Agent Helper)

**New Tasks Needed:**
- task-optimize-performance.md (update)
- task-suggest-refactoring.md (update)

---

### agent-github-devops (1 utility)
**Purpose:** Git operations abstraction

- git-wrapper (Agent Helper)

**Tasks:** No new tasks, used as helper

---

### agent-qa (1 utility)
**Purpose:** Migration testing

- migration-tester (Agent Helper)

**Tasks:** No new tasks, used as helper

---

### Framework (3 utilities)
**Purpose:** Core framework capabilities

- elicitation-session-manager (used by elicitation-engine)
- improvement-engine (self-improvement core)
- pattern-learner (learning from patterns)
- metrics-tracker (framework telemetry)

---

## Task Files Analysis

### Tasks to CREATE (2 new)

1. **task-generate-migration.md** - For migration-generator utility
   - Generate migration scripts between framework versions
   - Used by agent-architect
   
2. **task-rollback-modification.md** - For rollback-handler utility
   - Rollback framework modifications safely
   - Used by aios-developer

### Tasks to UPDATE (4 existing)

1. **task-propose-modification.md** (exists)
   - Add utils: modification-risk-assessment, modification-validator
   
2. **task-improve-self.md** (exists)
   - Add utils: improvement-engine, pattern-learner
   
3. **task-optimize-performance.md** (exists)
   - Add utils: performance-analyzer, performance-optimizer
   
4. **task-suggest-refactoring.md** (exists)
   - Add utils: refactoring-suggester
   
5. **task-analyze-framework.md** (exists)
   - Add utils: framework-analyzer

---

## Files to Modify Summary

### Agents (5 files)
1. `.aios-core/agents/aios-developer.md` (add 10 utilities)
2. `aios-fullstack/aios-core/agents/architect.md` (add 7 utilities)
3. `aios-fullstack/aios-core/agents/dev.md` (add 4 utilities)
4. `.aios-core/agents/github-devops.md` (add 1 utility)
5. `aios-fullstack/aios-core/agents/qa.md` (add 1 utility)

### Tasks (6 files)
1. `aios-fullstack/aios-core/tasks/generate-migration.md` (CREATE)
2. `aios-fullstack/aios-core/tasks/rollback-modification.md` (CREATE)
3. `aios-fullstack/aios-core/tasks/propose-modification.md` (UPDATE)
4. `aios-fullstack/aios-core/tasks/improve-self.md` (UPDATE)
5. `aios-fullstack/aios-core/tasks/optimize-performance.md` (UPDATE)
6. `aios-fullstack/aios-core/tasks/suggest-refactoring.md` (UPDATE)
7. `aios-fullstack/aios-core/tasks/analyze-framework.md` (UPDATE)

### Configuration (2 files)
1. `aios-fullstack/aios-core/core-config.yaml` (register 22 utilities)
2. `aios-fullstack/aios-core/core-config.yaml.backup-3.5` (backup)

### Documentation (1 file)
1. `aios-fullstack/aios-core/utils/README.md` (add 22 utility entries)

### Testing (1 file)
1. `aios-fullstack/tests/integration/test-utilities-part-2.js` (new test suite)

---

## Success Metrics

**After Integration:**
- ✅ 22/22 utilities registered in core-config.yaml
- ✅ 22/22 utilities documented in README.md
- ✅ 22/22 utilities referenced by at least one agent/task
- ✅ 0/22 gaps remaining in gap detection
- ✅ All utilities load without errors
- ✅ All agent configurations valid

**Cumulative (Stories 3.4 + 3.5):**
- 45/67 utilities integrated (67%)
- Category 1 (Orphaned Entity Integration) at 67% complete

---

## Risk Mitigation

**Risk 1:** aios-developer agent may not exist
- **Mitigation:** Check if agent exists; if not, map utilities to agent-dev or create as framework utilities
- **Decision:** PO/Architect sign-off if agent doesn't exist

**Risk 2:** Some utilities may require dependencies not available
- **Mitigation:** Check utility imports during categorization
- **Plan:** Document missing dependencies, track as technical debt

**Risk 3:** Modification utilities are high-risk (self-modification)
- **Mitigation:** Extra validation for modification utilities
- **Testing:** Thorough sandbox testing before production use

---

## Estimated Time Adjustment

**Original:** 8h  
**Corrected:** 7.5h (22 utilities vs 23)

**Breakdown:**
- Task 1: Categorize 22 utilities (1h)
- Task 2: Update 5 agents (1.5h)
- Task 3: Create/update 6 tasks (1.5h)
- Task 4: Update core-config (30min)
- Task 5: Document 22 utilities (1h)
- Task 6: Create test suite (45min)
- Task 7: Validation (45min)

**Total:** 6.75h → round to 7h

---

**Mapping Version:** 1.0.0  
**Status:** Complete - Ready for story refinement


