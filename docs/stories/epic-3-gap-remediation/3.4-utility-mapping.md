# Story 3.4: Utility Integration Mapping

**Created:** 2025-10-29  
**Authors:** Sarah (@po), Winston (@architect)  
**Purpose:** Define integration strategy for 23 utilities in Story 3.4

---

## Utility Categorization

### Category 1: Code Quality (5 utilities)

| # | Utility | Target Agent | Integration Pattern | Priority |
|---|---------|--------------|---------------------|----------|
| 1 | **util-aios-validator** | agent-qa | Framework | HIGH |
| 2 | **util-code-quality-improver** | agent-dev | Agent Helper | HIGH |
| 3 | **util-coverage-analyzer** | agent-qa | Agent Helper | MEDIUM |
| 4 | **util-compatibility-checker** | agent-dev | Agent Helper | MEDIUM |
| 5 | **util-dependency-analyzer** | agent-architect | Agent Helper | HIGH |

**Integration Approach:**
- Add to respective agent's `dependencies.utils`
- Document quality checks each utility performs
- Test with agent loading

---

### Category 2: Git/Workflow (7 utilities)

| # | Utility | Target Agent | Task | Integration Pattern | Priority |
|---|---------|--------------|------|---------------------|----------|
| 6 | **util-approval-workflow** | agent-po | task-manage-approvals | Task Execution | MEDIUM |
| 7 | **util-branch-manager** | agent-github-devops | task-manage-branches | Task Execution | HIGH |
| 8 | **util-commit-message-generator** | agent-dev | task-generate-commit-msg | Task Execution | HIGH |
| 9 | **util-conflict-manager** | agent-dev | task-resolve-conflicts | Agent Helper | HIGH |
| 10 | **util-conflict-resolver** | agent-dev | task-resolve-conflicts | Task Execution | HIGH |
| 11 | **util-diff-generator** | agent-dev | task-review-changes | Agent Helper | MEDIUM |
| 12 | **util-change-propagation-predictor** | agent-architect | (analysis) | Agent Helper | LOW |

**Integration Approach:**
- Create/update tasks for execution utilities
- Add to agent dependencies for helper utilities
- Test git workflow functionality

**Notes:**
- util-conflict-manager and util-conflict-resolver work together
- util-commit-message-generator likely needs new task created
- util-branch-manager integrates with github-devops agent

---

### Category 3: Component Management (5 utilities)

| # | Utility | Target Agent | Task | Integration Pattern | Priority |
|---|---------|--------------|------|---------------------|----------|
| 13 | **util-component-generator** | agent-dev | task-generate-component | Task Execution | HIGH |
| 14 | **util-component-metadata** | agent-dev | (helper) | Agent Helper | MEDIUM |
| 15 | **util-component-preview** | agent-dev | (helper) | Agent Helper | LOW |
| 16 | **util-component-search** | agent-dev | task-find-component | Task Execution | MEDIUM |
| 17 | **util-deprecation-manager** | agent-architect | task-deprecate-component | Task Execution | MEDIUM |

**Integration Approach:**
- Focus on component generation workflow
- util-component-generator is key utility
- Others support component operations
- Test component creation flow

**Notes:**
- util-component-metadata likely used by component-generator
- util-component-preview may be UI-related (low priority)
- util-deprecation-manager connects to architect role

---

### Category 4: Documentation (2 utilities)

| # | Utility | Target Agent | Task | Integration Pattern | Priority |
|---|---------|--------------|------|---------------------|----------|
| 18 | **util-documentation-synchronizer** | agent-architect | task-sync-documentation | Task Execution | HIGH |
| 19 | **util-dependency-impact-analyzer** | agent-architect | task-analyze-impact | Task Execution | HIGH |

**Integration Approach:**
- Both utilities serve architect agent
- Create/update tasks for each
- Focus on documentation and impact analysis workflows
- Test with architecture documentation

**Notes:**
- util-documentation-synchronizer is Story 2.4 related
- util-dependency-impact-analyzer helps with refactoring decisions

---

### Category 5: Batch/Helpers (4 utilities)

| # | Utility | Target Agent | Integration Pattern | Priority |
|---|---------|--------------|---------------------|----------|
| 20 | **util-batch-creator** | agent-dev | Agent Helper | HIGH |
| 21 | **util-clickup-helpers** | agent-pm | Agent Helper | MEDIUM |
| 22 | **util-capability-analyzer** | agent-architect | Agent Helper | MEDIUM |
| 23 | **util-elicitation-engine** | (framework) | Framework | HIGH |

**Integration Approach:**
- util-elicitation-engine is framework-level (agent creation)
- util-batch-creator helps with task batching
- util-clickup-helpers serves PM integration
- util-capability-analyzer for architecture analysis

**Notes:**
- util-elicitation-engine powers agent-elicitation.js
- util-clickup-helpers integrates with ClickUp MCP

---

## Integration Priority Order

### Phase 1: HIGH Priority (12 utilities) - 4 hours

**Quick Wins (Agent Helpers):**
1. util-code-quality-improver → agent-dev
2. util-dependency-analyzer → agent-architect
3. util-batch-creator → agent-dev
4. util-conflict-manager → agent-dev

**Task Creation Needed:**
5. util-commit-message-generator → agent-dev + new task
6. util-branch-manager → agent-github-devops + update task
7. util-component-generator → agent-dev + update task
8. util-documentation-synchronizer → agent-architect + task-sync-docs
9. util-dependency-impact-analyzer → agent-architect + task-analyze-impact

**Framework:**
10. util-elicitation-engine → framework registration
11. util-aios-validator → framework/agent-qa
12. util-conflict-resolver → agent-dev + task

### Phase 2: MEDIUM Priority (7 utilities) - 2 hours

13. util-approval-workflow → agent-po
14. util-diff-generator → agent-dev
15. util-coverage-analyzer → agent-qa
16. util-compatibility-checker → agent-dev
17. util-component-metadata → agent-dev
18. util-component-search → agent-dev
19. util-clickup-helpers → agent-pm
20. util-deprecation-manager → agent-architect
21. util-capability-analyzer → agent-architect

### Phase 3: LOW Priority (2 utilities) - 30 min

22. util-component-preview → agent-dev
23. util-change-propagation-predictor → agent-architect

**Total Estimated Time:** 6.5 hours (reduced from 8h due to clear mapping)

---

## Detailed Integration Steps

### Example: util-commit-message-generator

**1. Analyze** (5 min)
- Inspect `.aios-core/utils/commit-message-generator.js`
- Understand: Generates semantic commit messages from staged changes
- Category: Git/Workflow

**2. Map** (5 min)
- Target Agent: agent-dev (handles git operations)
- Task Needed: NEW task-generate-commit-message.md
- Pattern: Task Execution

**3. Integrate** (15 min)
- Create `.aios-core/tasks/generate-commit-message.md`:
  ```yaml
  id: generate-commit-message
  name: Generate Semantic Commit Message
  agent: dev
  execution:
    utils:
      - commit-message-generator
    steps:
      - Analyze git staged changes
      - Generate message using semantic conventions
      - Present to user for approval
  ```
- Update `.aios-core/agents/dev.yaml`:
  ```yaml
  executes:
    - generate-commit-message  # NEW
  ```
- Register in `.aios-core/core-config.yaml`:
  ```yaml
  utils:
    executors:
      - commit-message-generator  # NEW
  ```

**4. Test** (5 min)
- Load utility: `require('./utils/commit-message-generator')`
- Load agent-dev: verify task appears
- Run gap detection: verify 0 gaps

**5. Document** (5 min)
- Add to `.aios-core/utils/README.md`:
  ```markdown
  ### util-commit-message-generator
  **Purpose:** Generates semantic commit messages from git staged changes
  **Used By:** agent-dev via task-generate-commit-message
  **Pattern:** Task Execution
  ```

**Total Time:** 35 minutes per utility (detailed)

---

## Files to Create/Update

### New Task Files (8 tasks)
- `.aios-core/tasks/generate-commit-message.md`
- `.aios-core/tasks/manage-branches.md` (update existing)
- `.aios-core/tasks/resolve-conflicts.md` (update existing)
- `.aios-core/tasks/generate-component.md` (update existing)
- `.aios-core/tasks/find-component.md`
- `.aios-core/tasks/sync-documentation.md` (may exist)
- `.aios-core/tasks/analyze-impact.md` (may exist)
- `.aios-core/tasks/deprecate-component.md` (may exist)

### Agent Files to Update (8 agents)
- `.aios-core/agents/dev.yaml` (most utilities)
- `.aios-core/agents/qa.yaml`
- `.aios-core/agents/architect.yaml`
- `.aios-core/agents/github-devops.yaml`
- `.aios-core/agents/po.yaml`
- `.aios-core/agents/pm.yaml`

### Framework Files
- `.aios-core/core-config.yaml` (register all 23 utilities)
- `.aios-core/utils/README.md` (document all 23)
- `outputs/architecture-map/MASTER-RELATIONSHIP-MAP.json` (regenerate)

---

## Testing Strategy

### Per Utility Tests

**1. Load Test:**
```javascript
// test-utilities-part-1.js
const utilities = [
  'aios-validator',
  'approval-workflow',
  // ... all 23
];

utilities.forEach(util => {
  try {
    require(`.aios-core/utils/${util}`);
    console.log(`✓ ${util} loads successfully`);
  } catch (err) {
    console.error(`✗ ${util} failed:`, err.message);
  }
});
```

**2. Reference Validation:**
```bash
node outputs/architecture-map/schemas/validate-tool-references.js
# Expect: All utility references valid
```

**3. Gap Detection:**
```bash
node outputs/architecture-map/schemas/detect-gaps.js
# Expect: 0 gaps for these 23 utilities
```

**4. Agent Load Tests:**
```javascript
const agents = ['dev', 'qa', 'architect', 'github-devops', 'po', 'pm'];
agents.forEach(agent => {
  const agentConfig = loadAgent(agent);
  // Verify utils in dependencies resolve
});
```

---

## Success Metrics

**After Integration:**
- ✅ 23/23 utilities registered in core-config.yaml
- ✅ 23/23 utilities documented in README.md
- ✅ 23/23 utilities referenced by at least one agent/task
- ✅ 0/23 gaps remaining in gap detection
- ✅ All utilities load without errors
- ✅ All agent configurations valid

---

## Risk Mitigation

**Risk 1:** Utility may be obsolete/deprecated
- **Mitigation:** Inspect code first; if clearly obsolete, deprecate instead of integrate
- **Decision:** PO/Architect sign-off required to deprecate

**Risk 2:** Utility may require dependencies not available
- **Mitigation:** Check utility imports; resolve dependencies first
- **Plan:** Document missing dependencies, create sub-story if needed

**Risk 3:** Multiple agents may need same utility
- **Mitigation:** Add utility to multiple agents as needed
- **Pattern:** This is normal and expected (e.g., diff-generator used by dev and qa)

**Risk 4:** Task files may not exist yet
- **Mitigation:** Create minimal task files following task template
- **Scope:** Task creation is IN SCOPE for this story

---

## Mapping Version History

- **v1.0.0** (2025-10-29): Initial mapping by Sarah (@po) and Winston (@architect)

---

**This mapping serves as the implementation guide for Story 3.4.**  
**Estimated time reduced from 8h to 6.5h due to clear strategy.**

