# Story 3.18 - Development Briefing

**Developer**: James (@dev)
**Prepared By**: Sarah (@po)
**Date**: 2025-10-30
**Story Status**: Ready for Development ‚úÖ
**Estimated Effort**: 4 hours
**Priority**: HIGH

---

## üìã Story Quick Reference

**ID**: 3.18
**Title**: Utilities Cleanup & Deprecation - Remove Non-Functional Code
**Epic**: 3c-remediation
**Story File**: `docs/stories/epic-3-gap-remediation/3.18-utilities-cleanup-deprecation.yaml`

**Dependencies**:
- ‚úÖ Story 3.17 (Framework Utilities Audit) - **Done** (completed today)
- ‚úÖ UTILITIES-AUDIT-REPORT.md - Available and verified

---

## üéØ Mission

Remove 32 deprecated/non-functional utilities from `.aios-core/utils/` by archiving them (not deleting) to reduce technical debt and developer confusion.

**Key Principle**: **Safe removal with rollback capability**

---

## üìä What You're Cleaning Up

From Story 3.17 audit:
- **32 DEPRECATED utilities** (40% of 81 total)
- **Categories**:
  - 9 duplicates (aios-validator-fixed, -refactored versions)
  - 18 incomplete/obsolete utilities
  - 5 refactored versions needing consolidation
  - 1 test file in wrong location (aios-validator.test.js)

**After cleanup**:
- 49 utilities remain (60%)
- ~500KB code removed
- 35% reduction in maintenance burden

---

## üìÅ Key Files (All Verified to Exist)

**Input Files**:
- ‚úÖ `UTILITIES-AUDIT-REPORT.md` (lines 181-230: complete cleanup list)
- ‚úÖ `.aios-core/utils/` (81 utilities currently)
- ‚úÖ `.aios-core/core-config.yaml` (utils registry)

**Utilities You'll Use** (ironic - using "orphaned" utilities to clean up!):
- ‚úÖ `.aios-core/utils/safe-removal-handler.js` (23KB)
- ‚úÖ `.aios-core/utils/backup-manager.js` (17KB)
- ‚úÖ `.aios-core/utils/modification-validator.js` (17KB)
- ‚úÖ `.aios-core/utils/aios-validator.js` (7.5KB)

**Story File**:
- `docs/stories/epic-3-gap-remediation/3.18-utilities-cleanup-deprecation.yaml`

---

## ‚úÖ Pre-Implementation Checklist

Before you start, verify:

- [x] Story 3.17 marked as Done (blocks removed)
- [x] Story 3.18 status is "Ready" (not Draft)
- [x] UTILITIES-AUDIT-REPORT.md exists and is readable
- [x] All referenced utilities exist (safe-removal-handler, backup-manager, etc.)
- [x] You have the complete list of 32 utilities to archive (in audit report)
- [x] Story has Testing section with 5 test scenarios
- [x] Validation report exists (3.18-VALIDATION-REPORT.md)

**Status**: ‚úÖ All verified - Ready to proceed

---

## üîÑ Execution Workflow (7 Tasks)

### Task 1: Create cleanup-utilities.md task (30 min)
- Design safe removal workflow
- Integrate with safe-removal-handler.js
- Add dependency checking logic
- Write validation procedures

### Task 2: Analyze audit report (20 min)
- Read UTILITIES-AUDIT-REPORT.md lines 181-230
- Extract list of 32 DEPRECATED utilities
- Verify deprecation reasoning
- Confirm no WORKING utilities in removal list

### Task 3: Check dependencies for each utility (45 min)
- Run dependency checker on each of 32 utilities
- Flag any with active references (BLOCK removal)
- Create exception list for manual review
- Document why each is safe to remove

### Task 4: Create archive structure (15 min)
- Create `.aios-core/utils-archive/` directory
- Create `ARCHIVE-README.md` (content in story dev_notes line 164)
- Add archive date and story reference
- Document restoration procedure

### Task 5: Execute cleanup (60 min)
- Create timestamped backup: `.aios-core/utils.backup-3.18-$(date +%Y%m%d)`
- Move 32 DEPRECATED utilities to archive (use `git mv`)
- Update core-config.yaml registry (81 ‚Üí 49 utilities)
- Remove utility references from documentation

### Task 6: Validation (30 min)
- Run `node .aios-core/utils/aios-validator.js`
- Test @dev agent activation
- Test @po agent activation
- Verify no broken references introduced

### Task 7: Documentation updates (20 min)
- Update core-config.yaml entity counts
- Add cleanup note to Epic 3 changelog
- Update developer guides if needed
- Document rollback procedure (already in story)

**Total Estimated Time**: 220 minutes (3.7 hours) ‚úÖ Under 4h estimate

---

## üß™ Testing Requirements (CRITICAL)

Execute these 5 test scenarios **during** implementation:

### TEST-3.18.1: Archive Single Utility (Validate Process)
```bash
# Select 1 DEPRECATED utility from Category C
# Run dependency check (should show 0 references)
grep -r "utility-name" .aios-core/agents .aios-core/tasks
# Move to archive
git mv .aios-core/utils/utility-name.js .aios-core/utils-archive/
# Validate framework
node .aios-core/utils/aios-validator.js
# Test agents
# Expected: No errors, agents activate
```

### TEST-3.18.2: Block Removal with Dependencies (Safety Test)
```bash
# Select 1 WORKING utility (e.g., clickup-helpers.js)
# Attempt dependency check
grep -r "clickup-helpers" .aios-core/
# Expected: Should find references, BLOCK removal
```

### TEST-3.18.3: Full Framework Validation
```bash
# After archiving all 32 utilities
node .aios-core/utils/aios-validator.js
# Test all agents: @dev, @po, @qa activation
# Expected: All pass, no broken references
```

### TEST-3.18.4: Rollback Test (CRITICAL)
```bash
# Before cleanup: Create backup
cp -r .aios-core/utils .aios-core/utils.backup-3.18-20251030
# Archive 3-5 utilities
# Execute rollback
rm -rf .aios-core/utils
cp -r .aios-core/utils.backup-3.18-20251030 .aios-core/utils
# Validate
node .aios-core/utils/aios-validator.js
# Expected: Framework restored, validation passes
```

### TEST-3.18.5: Documentation Validation
```bash
# Check core-config.yaml updated (81 ‚Üí 49)
# Verify ARCHIVE-README.md exists
# Confirm changelog entry added
# Expected: All documentation accurate
```

---

## üéØ Success Criteria (Must ALL Pass)

- [ ] All 28 deprecated utilities archived without errors
- [ ] Zero broken references introduced (grep validation passes)
- [ ] All agents (@dev, @po, @qa) activate successfully post-cleanup
- [ ] Framework validation passes: `node .aios-core/utils/aios-validator.js` (0 errors)
- [ ] Rollback procedure tested and works
- [ ] core-config.yaml accurately reflects new count (49 utilities)
- [ ] Archive structure exists with proper README
- [ ] No utility references in agents point to archived utilities

---

## üö® Blocking Conditions (HALT if encountered)

**HALT and ask user if**:
1. Dependency check finds active references to a utility marked DEPRECATED
2. Framework validation fails after archiving utilities
3. Agent activation fails after cleanup
4. More than 32 utilities need archiving (count mismatch with audit)
5. Any utility you're archiving is NOT in the audit report DEPRECATED list
6. Rollback test fails

---

## üìù Story File Updates (Your Responsibility)

**ONLY update these sections**:
- [ ] Tasks/Subtasks checkboxes (mark [x] as complete)
- [ ] Dev Agent Record ‚Üí Agent Model Used
- [ ] Dev Agent Record ‚Üí Completion Notes
- [ ] Dev Agent Record ‚Üí File List (CRITICAL - list all moved files)
- [ ] Change Log (add v2.0.0 entry at completion)
- [ ] Status (Ready ‚Üí Ready for Review when done)

**DO NOT modify**: Story, Acceptance Criteria, Dev Notes, Testing sections

---

## üì¶ Expected File Changes

**Created** (2-3 files):
- `.aios-core/utils-archive/` (directory)
- `.aios-core/utils-archive/ARCHIVE-README.md`
- `.aios-core/tasks/cleanup-utilities.md`
- `.aios-core/utils.backup-3.18-YYYYMMDD/` (backup)

**Modified** (1-2 files):
- `.aios-core/core-config.yaml` (utils count: 81 ‚Üí 49)
- `docs/stories/epic-3-gap-remediation/3.18-utilities-cleanup-deprecation.yaml` (your updates)

**Moved** (32 files):
- 32 utilities from `.aios-core/utils/` ‚Üí `.aios-core/utils-archive/`

**Total File Operations**: ~35-40 files

---

## üîß Helpful Commands Reference

**Dependency Check**:
```bash
grep -r "utility-name" .aios-core/agents .aios-core/tasks
```

**Archive Utility**:
```bash
git mv .aios-core/utils/utility-name.js .aios-core/utils-archive/
```

**Backup**:
```bash
cp -r .aios-core/utils .aios-core/utils.backup-3.18-$(date +%Y%m%d)
```

**Framework Validation**:
```bash
node .aios-core/utils/aios-validator.js
```

**Count Utilities**:
```bash
ls -1 .aios-core/utils/*.js | wc -l
```

---

## üìä Progress Tracking

**Start**: Mark story status "InProgress"
**During**: Update task checkboxes [x] after each task
**Testing**: Execute all 5 test scenarios
**Completion**: All tasks [x], all tests pass, File List complete
**Ready**: Status ‚Üí "Ready for Review", HALT for QA

---

## üéì Story Context (Dev Notes Summary)

**Leveraged "Orphaned" Utilities** (Ironic!):
- safe-removal-handler.js - Perfect for this task!
- modification-validator.js - Validate cleanup didn't break anything
- backup-manager.js - Create rollback-capable backups

**Safe Removal Workflow** (from story lines 133-163):
1. Pre-cleanup backup ‚úÖ
2. Dependency check (CRITICAL) ‚úÖ
3. Archive (don't delete) ‚úÖ
4. Validate framework ‚úÖ

**Rollback Procedure** (if cleanup breaks something):
```bash
rm -rf .aios-core/utils
cp -r .aios-core/utils.backup-3.18-YYYYMMDD .aios-core/utils
```

---

## üìö Reference Documents

1. **Story File**: `docs/stories/epic-3-gap-remediation/3.18-utilities-cleanup-deprecation.yaml`
2. **Validation Report**: `docs/stories/epic-3-gap-remediation/3.18-VALIDATION-REPORT.md`
3. **Audit Report**: `UTILITIES-AUDIT-REPORT.md` (lines 181-230 for cleanup list)
4. **Epic 3 Context**: `docs/stories/epic-3-gap-remediation/`

---

## ‚úÖ Final Pre-Flight Check

Before you type `*develop`, verify:

- [x] Story status is "Ready" (not Draft)
- [x] Story 3.17 is Done (unblocks 3.18)
- [x] You've read the entire story file
- [x] You understand the 7 tasks
- [x] You know the 5 test scenarios
- [x] You have the cleanup list from audit report
- [x] You understand rollback procedure
- [x] Estimated time: 4 hours ‚úÖ

---

## üöÄ Ready to Start?

**Command**: `*develop`

**Expected Duration**: 3.7 hours (under 4h estimate)

**Expected Outcome**: 32 utilities safely archived, framework validated, agents working, documentation updated, rollback tested.

---

**Good luck, James! üíª**

**- Sarah (@po)**
