# Story 3.26 - QA Testing Guide

**Story:** MCP Context Optimization - Phase 1 (1MCP)
**Status:** Ready for QA
**Developer:** James (@dev)
**Completed:** 2025-10-26

---

## ðŸŽ¯ What Was Delivered

This story delivers **87% token reduction** (from 280k to 26k tokens) through 1MCP MCP aggregator with fully automated installation.

### Key Deliverables:
1. âœ… 1MCP integration with 9 MCPs (3 functional immediately)
2. âœ… Automated installers for Windows and Linux/macOS
3. âœ… Centralized API key management via .claude-env
4. âœ… Complete documentation (installation, API keys, troubleshooting)
5. âœ… Auto-start service configuration
6. âœ… **87% token reduction validated by user**

---

## ðŸ§ª QA Test Plan

**Total Tests:** 36 tests across 9 categories
**Estimated QA Time:** 6-8 hours (3-4 hours per platform)

### Test Categories:
1. **Functional Tests (9 tests)** - Core functionality validation
2. **Installation Tests (5 tests)** - New user experience
3. **Documentation Tests (4 tests)** - Doc completeness
4. **Security Tests (3 tests)** - API key safety
5. **Performance Tests (3 tests)** - Speed and resource usage
6. **Rollback Tests (3 tests)** - Recovery procedures
7. **Preset Functionality Tests (4 tests)** - **[NEW]** Validate AC FR-3.26.2
8. **Hot-Reload Tests (3 tests)** - **[NEW]** Validate AC FR-3.26.3
9. **Legacy Config Preservation (2 tests)** - **[NEW]** Complete AC TR-3.26.2

---

## ðŸš€ Quick Start for QA

### Prerequisites:
- Fresh Windows VM or clean user account
- Fresh Linux VM (Ubuntu 20.04+) or macOS
- Claude Code installed
- Node.js 18+ installed

### Test Environment Setup (5 minutes):

```bash
# 1. Clone repository
git clone https://github.com/your-org/aios-fullstack.git
cd aios-fullstack

# 2. Checkout story branch (if not merged)
git checkout story/3.26-mcp-optimization

# 3. You're ready to test!
```

---

## ðŸ“‹ Critical Path Testing (Must Pass)

These are the **minimum tests** QA must execute to approve:

### âœ… Test 1: Automated Installation

**Platform:** Windows

```cmd
# Execute installer
scripts\install-aios.cmd

# Expected Result:
# - All 8 steps complete without errors
# - Notepad opens with ~/.claude-env
# - Installation completes in <20 minutes
```

**Pass/Fail:** ___________

---

### âœ… Test 2: Token Reduction Validation

**After installation, start 1MCP:**

```cmd
scripts\start-1mcp-with-env.cmd
```

**In Claude Code:**
```
/context
```

**Expected Result:**
- Token usage: ~26k/200k (13%)
- Free space: ~174k (87%)

**Actual Result:** ___________
**Pass/Fail:** ___________

---

### âœ… Test 3: MCP Functionality

**In Claude Code, test GitHub MCP:**
```
Liste os repositÃ³rios do usuÃ¡rio anthropics no GitHub
```

**Expected Result:**
- GitHub MCP responds with repository list
- No errors

**Pass/Fail:** ___________

---

### âœ… Test 4: Documentation Accuracy

**File:** `docs/installation/aios-fullstack-setup.md`

**Validation:**
- Follow installation guide step-by-step
- Check if all commands work
- Verify all links are valid

**Issues Found:** _____________________________
**Pass/Fail:** ___________

---

### âœ… Test 5: Security - API Keys Not Exposed

**Check .gitignore:**
```bash
git check-ignore ~/.claude-env
# Should return: /c/Users/.../.claude-env (file is ignored)

git log -p | grep -i "EXA_API_KEY" | grep -v "your-exa-api-key-here"
# Should return: nothing (no actual keys in git history)
```

**Pass/Fail:** ___________

---

## ðŸ“Š Full Test Matrix

### Category 1: Functional Tests (9 tests)

| Test | Description | Platform | Pass/Fail | Notes |
|------|-------------|----------|-----------|-------|
| 1.1 | 1MCP server starts | Win/Linux | __ / __ | |
| 1.2 | Env vars loaded | Win/Linux | __ / __ | |
| 1.3 | MCPs configured | Win/Linux | __ / __ | |
| 1.4 | Presets created | Win/Linux | __ / __ | |
| 1.5 | Claude Code integration | Win/Linux | __ / __ | |
| 1.6 | Token reduction | Win/Linux | __ / __ | |
| 1.7 | GitHub MCP works | Win/Linux | __ / __ | |
| 1.8 | Browser MCP works | Win/Linux | __ / __ | |
| 1.9 | Context7 MCP works | Win/Linux | __ / __ | |

### Category 2: Installation Tests (5 tests)

| Test | Description | Platform | Pass/Fail | Notes |
|------|-------------|----------|-----------|-------|
| 2.1 | Automated installer (Win) | Windows | _____ | |
| 2.2 | Automated installer (Linux) | Linux | _____ | |
| 2.3 | API keys UX | Both | _____ | |
| 2.4 | Auto-start (NSSM) | Windows | _____ | |
| 2.5 | Auto-start (systemd) | Linux | _____ | |

### Category 3: Documentation Tests (4 tests)

| Test | Description | Pass/Fail | Notes |
|------|-------------|-----------|-------|
| 3.1 | Installation guide | _____ | |
| 3.2 | API keys guide | _____ | |
| 3.3 | Troubleshooting | _____ | |
| 3.4 | Scripts README | _____ | |

### Category 4: Security Tests (3 tests)

| Test | Description | Pass/Fail | Notes |
|------|-------------|-----------|-------|
| 4.1 | .gitignore configured | _____ | |
| 4.2 | No API keys exposed | _____ | |
| 4.3 | Template has placeholders | _____ | |

### Category 5: Performance Tests (3 tests)

| Test | Description | Target | Actual | Pass/Fail |
|------|-------------|--------|--------|-----------|
| 5.1 | Startup time | <30s | _____ | _____ |
| 5.2 | Memory usage (1h) | <500MB | _____ | _____ |
| 5.3 | Response time | <500ms | _____ | _____ |

### Category 6: Rollback Tests (3 tests)

| Test | Description | Pass/Fail | Notes |
|------|-------------|-----------|-------|
| 6.1 | Rollback documented | _____ | |
| 6.2 | Backup exists | _____ | |
| 6.3 | Rollback execution | _____ | |

### Category 7: Preset Functionality Tests (4 tests) **[ADDED BY QA]**

| Test | Description | Platform | Pass/Fail | Notes |
|------|-------------|----------|-----------|-------|
| 7.1 | Preset filtering - aios-dev | Win/Linux | _____ | Verify only github, browser load |
| 7.2 | Preset filtering - aios-research | Win/Linux | _____ | Verify only context7, browser, exa load |
| 7.3 | Preset filtering - aios-pm | Win/Linux | _____ | Verify only clickup, google-workspace load |
| 7.4 | Preset switching | Win/Linux | _____ | Switch devâ†’researchâ†’full, verify tools change |

**Test 7.1: Preset Filtering - aios-dev**
```bash
# 1. Start 1MCP with aios-dev preset
scripts\start-1mcp-with-env.cmd

# 2. In Claude Code, run /mcp
# Expected: Only 1mcp-dev endpoint shows github, browser tools
# Not expected: context7, exa, clickup tools

# 3. Test a github tool
# Ask: "List repositories for user anthropics"
# Pass criteria: GitHub MCP responds successfully
```

**Test 7.2: Preset Filtering - aios-research**
```bash
# 1. Stop 1MCP, restart with preset parameter
1mcp serve --port 3050 --host 127.0.0.1

# 2. Connect Claude Code to 1mcp-research endpoint
# 3. Run /mcp
# Expected: Only context7, browser, exa tools available
# Not expected: github, clickup tools

# 4. Test context7 tool
# Ask: "Search Context7 for React hooks documentation"
# Pass criteria: Context7 MCP responds
```

**Test 7.3: Preset Filtering - aios-pm**
```bash
# Connect to 1mcp-pm endpoint
# Expected: Only clickup, google-workspace tools
# Note: May fail if Story 3.26.1 not complete (packages not found)
# Pass criteria: Preset loads only specified MCPs (even if non-functional)
```

**Test 7.4: Preset Switching**
```bash
# 1. Connect to 1mcp-dev
# 2. Run /context - record token usage (should be ~26k)
# 3. Disconnect, connect to 1mcp-research
# 4. Run /context - record token usage (should be ~40-60k)
# 5. Disconnect, connect to 1mcp-full
# 6. Run /context - record token usage (should be ~60-80k)
# Pass criteria: Token usage increases with more MCPs per preset
```

### Category 8: Hot-Reload Tests (3 tests) **[ADDED BY QA]**

| Test | Description | Pass/Fail | Notes |
|------|-------------|-----------|-------|
| 8.1 | Add MCP without restart | _____ | |
| 8.2 | Update preset without restart | _____ | |
| 8.3 | Verify changes in Claude Code | _____ | |

**Test 8.1: Add MCP Without Restart**
```bash
# 1. Start 1MCP server
scripts\start-1mcp-with-env.cmd

# 2. Note initial MCP count
1mcp mcp list  # Should show 9 MCPs (or 3 if before Story 3.26.1)

# 3. Add a test MCP (without stopping 1MCP)
1mcp mcp add test-server -- npx -y @modelcontextprotocol/server-everything

# 4. Verify added
1mcp mcp list  # Should show +1 MCP

# 5. Wait <5 seconds

# 6. In Claude Code, run /mcp
# Expected: New MCP appears without needing to restart Claude Code
# Pass criteria: Hot-reload works, new MCP available immediately
```

**Test 8.2: Update Preset Without Restart**
```bash
# 1. 1MCP server running
# 2. Update aios-dev preset to include context7
1mcp preset update aios-dev --filter "github,browser,context7"

# 3. Reconnect Claude Code to 1mcp-dev endpoint

# 4. Run /mcp
# Expected: context7 now appears in aios-dev
# Pass criteria: Preset changes reflect immediately
```

**Test 8.3: Verify Changes in Claude Code**
```bash
# After Test 8.1 or 8.2:
# 1. Run /context in Claude Code
# 2. Verify token count changed (if added MCP)
# 3. Test new tool functionality
# Pass criteria: Claude Code sees configuration changes without full restart
```

### Category 9: Legacy Config Preservation Tests (2 tests) **[ADDED BY QA]**

| Test | Description | Pass/Fail | Notes |
|------|-------------|-----------|-------|
| 9.1 | Backup config exists | _____ | |
| 9.2 | Legacy MCPs preserved | _____ | |

**Test 9.1: Backup Config Exists**
```bash
# Verify backup was created during migration
ls ~/.claude.json.backup-pre-1mcp

# Expected: File exists, dated around Story 3.26 implementation
# Pass criteria: Backup file exists and is valid JSON
```

**Test 9.2: Legacy MCPs Preserved**
```bash
# Read backup config
cat ~/.claude.json.backup-pre-1mcp

# Expected: Contains original individual MCP configurations
# (exa, context7, github, browser, clickup, supabase, etc.)
# Pass criteria: All original MCPs preserved in backup for fallback
```

---

## ðŸ“Š Updated Test Summary

**Total Tests:** 27 â†’ **36 tests** (9 new tests added)

**New Test Categories:**
- Category 7: Preset Functionality (4 tests) - **CRITICAL GAP ADDRESSED**
- Category 8: Hot-Reload (3 tests) - **AC FR-3.26.3 VALIDATED**
- Category 9: Legacy Config Preservation (2 tests) - **AC TR-3.26.2 COMPLETED**

**Updated Pass Rate Target:** 36/36 tests (100%)

---

## ðŸ› Bug Reporting Template

**If you find a bug, use this template:**

```
**Bug ID:** QA-3.26-###
**Severity:** Critical / High / Medium / Low
**Platform:** Windows / Linux / macOS
**Test:** Test X.Y - Test Name

**Description:**
[What went wrong]

**Steps to Reproduce:**
1.
2.
3.

**Expected Result:**
[What should have happened]

**Actual Result:**
[What actually happened]

**Screenshots/Logs:**
[Attach if available]

**Impact:**
[How this affects users]

**Workaround:**
[Temporary fix, if any]
```

---

## âœ… Sign-Off Checklist

Before approving this story, verify:

- [ ] **36/36 tests passed** (100% pass rate required)
  - [ ] Categories 1-6: 27/27 original tests
  - [ ] Category 7: 4/4 preset functionality tests
  - [ ] Category 8: 3/3 hot-reload tests
  - [ ] Category 9: 2/2 legacy config tests
- [ ] **No critical or high-severity bugs** found
- [ ] **Documentation is accurate** (all commands work)
- [ ] **Works on Windows, Linux, and macOS**
- [ ] **Security validated** (no API keys exposed)
- [ ] **Performance acceptable** (startup <30s, memory <500MB)
- [ ] **User experience is smooth** (installation <20 min)
- [ ] **All acceptance criteria validated** (including previously untested FR-3.26.2, FR-3.26.3)

---

## ðŸ“ž QA Contacts

**Questions during testing?**

- **Developer:** James (@dev) - Available for clarifications
- **Architect:** Winston (@architect) - Technical questions
- **Product Owner:** Sarah (@po) - Requirements clarification

**Slack Channels:**
- #qa-story-3-26
- #aios-development

---

## ðŸŽ¯ Expected QA Outcome

**If all tests pass:**
- Story marked as "QA Approved"
- Ready for merge to main branch
- Ready for release v1.0.0-mcp-optimization

**If bugs found:**
- Create bug tickets using template above
- Developer fixes bugs
- Re-test after fixes
- Repeat until 100% pass rate

---

## ðŸ“ QA Sign-Off

**QA Lead:**
- Name: _____________________
- Date: _____________________
- Signature: _________________

**QA Testers:**
- Tester 1 (Windows): _____________________
- Tester 2 (Linux): _____________________
- Tester 3 (macOS): _____________________

**Test Results:**
- Total Tests: 36 (updated from 27)
- Passed: _____
- Failed: _____
- Blocked: _____
- Pass Rate: _____%

**Test Breakdown:**
- Categories 1-6 (Original): ___/27
- Category 7 (Preset Tests): ___/4
- Category 8 (Hot-Reload): ___/3
- Category 9 (Legacy Config): ___/2

**Recommendation:**
- [ ] **APPROVE** - Story ready for production
- [ ] **REJECT** - Bugs must be fixed before approval
- [ ] **CONDITIONAL APPROVE** - Minor issues documented, can be addressed post-release

**Note:** Categories 7-9 added by QA (@qa) to address acceptance criteria gaps identified
in quality gate review. These tests validate FR-3.26.2 (preset workflows), FR-3.26.3
(hot-reload capability), and TR-3.26.2 (legacy config preservation).

**Comments:**
____________________________________________________________
____________________________________________________________
____________________________________________________________

---

**Thank you for testing Story 3.26!** ðŸŽ‰
