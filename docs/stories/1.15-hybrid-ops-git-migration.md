# Story 1.15: Hybrid-Ops Git Migration to AIOS-Fullstack

**Epic**: Hybrid-Ops: Pedro Valério Mind Integration
**Status**: ✅ **COMPLETE** (2025-01-20)
**Assignee**: Developer
**Story Points**: 5 (2 hours actual)

---

## User Story

As a **AIOS framework developer**,
I want **Hybrid-Ops expansion pack migrated to aios-fullstack structure with proper Git integration**,
so that **the expansion pack can be versioned independently and follows proper repository organization**.

---

## Acceptance Criteria

- [x] **AC1**: Legacy version backed up to `hybrid-ops.legacy/`
- [x] **AC2**: Refactored Hybrid-Ops moved to `aios-fullstack/expansion-packs/hybrid-ops/`
- [x] **AC3**: Junction link created at `.claude/commands/hybridOps/` for backward compatibility
- [x] **AC4**: Package.json updated with `@aios-fullstack/hybrid-ops` scope and repository metadata
- [x] **AC5**: Comprehensive INSTALLATION.md created with migration details
- [x] **AC6**: All 29 tests passing after migration
- [x] **AC7**: Mind loading infrastructure works from new location
- [x] **AC8**: Git commit completed in aios-fullstack repository

---

## Integration Verification

- [x] **IV1**: Junction link functions correctly on Windows
- [x] **IV2**: Configuration loading from new path works
- [x] **IV3**: All mind artifacts load successfully
- [x] **IV4**: Pedro Valério heuristics compile from new location
- [x] **IV5**: Performance requirements maintained (<500ms loading, <10ms cached)

---

## Migration Details

### From Structure
```
.claude/commands/hybridOps/
├── agents/
├── tasks/
├── utils/
├── tools/
├── tests/
├── config/
└── docs/
```

### To Structure
```
aios-fullstack/expansion-packs/
├── hybrid-ops/              # New location
│   ├── agents/              # 18 agents (9 generic + 9 PV-powered)
│   ├── tasks/               # 9 executable workflows
│   ├── utils/               # 14 utility modules
│   ├── tools/               # 3 PV-powered tools
│   ├── tests/               # Test suites
│   ├── config/              # Configuration files
│   ├── docs/                # Documentation
│   ├── package.json         # NPM configuration
│   └── INSTALLATION.md      # Installation guide
│
├── hybrid-ops.legacy/       # Backup of old version
│
.claude/commands/
└── hybridOps/ → aios-fullstack/expansion-packs/hybrid-ops/  # Junction link
```

---

## Test Results

### Test Execution Summary
**Command**: `npm test`
**Location**: `aios-fullstack/expansion-packs/hybrid-ops/`
**Result**: ✅ 29/29 tests passing

### Test Breakdown
1. **Mind Loader Suite** (6 tests)
   - ✅ Create PedroValerioMind instance
   - ✅ Get singleton instance
   - ✅ Correct mind paths
   - ✅ Load mind components
   - ✅ Get metadata
   - ✅ Apply mind to agent

2. **Axioma Validator Suite** (9 tests)
   - ✅ Create AxiomaValidator instance
   - ✅ AXIOM_LEVELS defined
   - ✅ CORE_AXIOMS defined
   - ✅ Validate content with high score
   - ✅ Detect veto condition on incoherence
   - ✅ Validate with specific levels only
   - ✅ Generate validation report
   - ✅ Track validation history
   - ✅ Clear validation history

3. **Heuristic Compiler Suite** (13 tests)
   - ✅ Create HeuristicCompiler instance
   - ✅ HEURISTIC_TEMPLATES defined
   - ✅ Compile PV_BS_001 (Future Back-Casting)
   - ✅ Compile PV_PA_001 (Coherence Scan)
   - ✅ Apply veto in PV_PA_001 for low truthfulness
   - ✅ Compile PV_PM_001 (Automation Check)
   - ✅ Apply veto in PV_PM_001 for missing guardrails
   - ✅ Cache compiled heuristics
   - ✅ Compile multiple heuristics
   - ✅ Register custom template
   - ✅ Get available heuristics
   - ✅ Get heuristic metadata
   - ✅ Get compilation stats

4. **Integration Suite** (1 test)
   - ✅ Full Mind Loading Pipeline (load, compile, validate)

### Performance Metrics
- Mind loading: 16ms (requirement: <500ms) ✅
- Cached operations: <1ms (requirement: <10ms) ✅
- Configuration loading: Success from new path ✅
- Heuristics compiled: 3 (PV_BS_001, PV_PA_001, PV_PM_001) ✅

---

## Migration Steps Executed

1. **Backup Legacy Version**
   ```bash
   # Renamed old version to hybrid-ops.legacy/
   mv aios-fullstack/expansion-packs/hybrid-ops aios-fullstack/expansion-packs/hybrid-ops.legacy
   ```

2. **Copy Refactored Version**
   ```bash
   # Copied from .claude/commands/hybridOps/ to new location
   cp -r .claude/commands/hybridOps aios-fullstack/expansion-packs/hybrid-ops
   ```

3. **Create Junction Link** (Windows)
   ```powershell
   # Created junction for backward compatibility
   New-Item -ItemType Junction -Path '.\.claude\commands\hybridOps' -Target '.\aios-fullstack\expansion-packs\hybrid-ops'
   ```

4. **Update Package Configuration**
   - Changed name: `hybridops-pv-refactored` → `@aios-fullstack/hybrid-ops`
   - Added repository metadata
   - Added installation scripts

5. **Create Documentation**
   - Created comprehensive INSTALLATION.md (298 lines)
   - Documented migration process
   - Added troubleshooting section
   - Included rollback instructions

6. **Git Commit**
   ```bash
   # Committed in aios-fullstack repository
   git add .
   git commit -m "feat: migrate hybrid-ops to expansion-packs structure [Story 1.15]"
   # Commit: 8c42492
   # Files: 221 changed, 106998 insertions
   ```

7. **Verification**
   - Ran full test suite: `npm test`
   - Verified configuration loading
   - Confirmed mind artifacts loading
   - Validated heuristic compilation

---

## Issues Encountered & Resolved

### Issue 1: Symlink Creation Failed
- **Error**: Initial `mklink /D` command produced no output
- **Solution**: Switched to PowerShell `New-Item -ItemType Junction`
- **Resolution**: Junction link created successfully

### Issue 2: Git "nul" File Error
- **Error**: `error: open(".claude/commands/hybridOps/nul"): No such file or directory`
- **Solution**: Removed problematic file with `rm -f aios-fullstack/expansion-packs/hybrid-ops/nul`
- **Resolution**: Git operations proceeded successfully

### Issue 3: Embedded Git Repository Warning
- **Warning**: "adding embedded git repository: aios-fullstack"
- **Solution**: Removed from staging in main repo, committed in aios-fullstack repo instead
- **Resolution**: Proper separation of repositories maintained

---

## Configuration Changes

### package.json Updates
```json
{
  "name": "@aios-fullstack/hybrid-ops",
  "version": "1.0.0",
  "description": "Hybrid-Ops Expansion Pack - Process Mapping with Pedro Valério's Mind Architecture",
  "repository": {
    "type": "git",
    "url": "https://github.com/allfluence/aios-fullstack",
    "directory": "expansion-packs/hybrid-ops"
  },
  "scripts": {
    "test": "node --test tests/mind-loading.test.js tests/workflow.test.simple.js",
    "install:expansion": "node install.js",
    "link:commands": "node scripts/create-junction.js"
  }
}
```

### New Configuration Path
- **Old**: `.claude/commands/hybridOps/config/heuristics.yaml`
- **New**: `aios-fullstack/expansion-packs/hybrid-ops/config/heuristics.yaml`
- **Status**: ✅ Loading successfully from new path

---

## File List

**Created:**
- `aios-fullstack/expansion-packs/hybrid-ops/` (complete structure migrated)
- `aios-fullstack/expansion-packs/hybrid-ops/INSTALLATION.md` (298 lines)
- `.claude/commands/hybridOps/` (junction link)
- `docs/stories/1.15-hybrid-ops-git-migration.md` (this file)

**Modified:**
- `aios-fullstack/expansion-packs/hybrid-ops/package.json` (name, repository, scripts)

**Renamed:**
- `aios-fullstack/expansion-packs/hybrid-ops/` → `aios-fullstack/expansion-packs/hybrid-ops.legacy/`

**Git Commits:**
- Commit 8c42492: "feat: migrate hybrid-ops to expansion-packs structure [Story 1.15]"
  - Repository: aios-fullstack
  - Files changed: 221
  - Insertions: 106,998

---

## Rollback Instructions

If migration causes issues, restore legacy version:

```bash
# Remove junction
rm .claude/commands/hybridOps

# Restore legacy
mv aios-fullstack/expansion-packs/hybrid-ops.legacy .claude/commands/hybridOps

# Remove new location
rm -rf aios-fullstack/expansion-packs/hybrid-ops
```

---

## Dependencies

- AIOS Framework v4.31.0+
- Node.js ≥18.0.0
- Pedro Valério mind artifacts at `outputs/minds/pedro_valerio/`
- YAML parser (yaml@^2.3.4)
- Windows PowerShell (for junction creation)

---

## Results

- **Migration Time**: ~2 hours (vs 1 week estimated)
- **Test Success Rate**: 100% (29/29 passing)
- **Performance**: Within all requirements
- **Backward Compatibility**: Maintained via junction link
- **Documentation**: Comprehensive installation guide created

---

## Notes

This migration establishes the proper Git structure for the Hybrid-Ops expansion pack, allowing independent versioning and better organization within the AIOS ecosystem. The junction link ensures backward compatibility for existing workflows while the new structure enables proper package management and distribution.

Key architectural decisions:
- Separate Git repository for aios-fullstack
- Junction link for backward compatibility
- NPM package scoping with @aios-fullstack namespace
- Comprehensive documentation for migration and installation
- Legacy backup preserved for emergency rollback

---

## Next Steps

1. ✅ Verify all tests passing
2. ✅ Confirm configuration loading from new path
3. ✅ Document migration in story file
4. ⏭️ Continue Phase 2+ stories (1.3-1.14)
5. ⏭️ Consider publishing to npm registry

---

**Related Documents:**
- PRD: `docs/prd/hybrid-ops-pv-mind-integration.md`
- Architecture: `docs/architecture/hybrid-ops-pv-mind-integration.md`
- Phase 1 Story: `docs/stories/1.1-phase-1-foundation.md`
- Installation Guide: `aios-fullstack/expansion-packs/hybrid-ops/INSTALLATION.md`
- Refactoring Plan: `HYBRID-OPS-REFACTORING-PLAN.md`

---

**Last Updated**: 2025-01-20
**Migration Status**: ✅ Complete
**Story**: Story 1.15 - Hybrid-Ops Git Migration
